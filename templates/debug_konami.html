<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Debug Konami - Puissance 4</title>
    <style>
        body {
            background: #1a1a1a;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 2rem;
        }
        #console {
            background: #000;
            border: 2px solid #0f0;
            padding: 1rem;
            height: 400px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .log { margin: 0.25rem 0; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0ff; }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 0.5rem;
        }
        button:hover { background: #0c0; }
    </style>
</head>
<body>
    <h1>🎮 Debug Code Konami - Puissance 4</h1>
    <p>Tapez: <strong>↑ ↑ ↓ ↓ A B A B</strong></p>
    
    <button onclick="testAPI()">🧪 Tester l'API directement</button>
    <button onclick="clearConsole()">🗑️ Effacer</button>
    
    <div id="console"></div>

    <script>
        var consoleDiv = document.getElementById('console');
        var konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'a', 'b', 'a', 'b'];
        var konamiIndex = 0;

        function log(msg, type) {
            var entry = document.createElement('div');
            entry.className = 'log ' + (type || 'info');
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            consoleDiv.appendChild(entry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(msg);
        }

        function clearConsole() {
            consoleDiv.innerHTML = '';
            log('Console effacée', 'info');
        }

        function testAPI() {
            log('🧪 Test manuel de l\'API...', 'info');
            fetch('/api/launch-easteregg', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(r => r.json())
            .then(data => {
                log('✅ API OK: ' + JSON.stringify(data), 'success');
            })
            .catch(err => {
                log('❌ Erreur API: ' + err, 'error');
            });
        }

        // Écouteur Konami
        document.addEventListener('keydown', function(e) {
            log('🎹 Touche: ' + e.key + ' | Attendu: ' + konamiSequence[konamiIndex] + ' | Progress: ' + konamiIndex + '/8', 'info');
            
            var expectedKey = konamiSequence[konamiIndex];
            var pressedKey = e.key;
            
            var isMatch = false;
            if(expectedKey === 'a' || expectedKey === 'b') {
                isMatch = pressedKey.toLowerCase() === expectedKey;
            } else {
                isMatch = pressedKey === expectedKey;
            }
            
            if(isMatch) {
                konamiIndex++;
                log('✅ Correct! [' + konamiIndex + '/8]', 'success');
                
                if(konamiIndex === konamiSequence.length) {
                    log('🎊🎊🎊 SÉQUENCE COMPLÈTE! 🎊🎊🎊', 'success');
                    log('🚀 Lancement de l\'API...', 'info');
                    
                    fetch('/api/launch-easteregg', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    })
                    .then(r => r.json())
                    .then(data => {
                        log('✅ ESPERSOUL2 lancé! ' + JSON.stringify(data), 'success');
                        alert('🎮 ESPERSOUL2 LANCÉ!\n\nVérifiez votre terminal.');
                    })
                    .catch(err => {
                        log('❌ Erreur: ' + err, 'error');
                    });
                    
                    konamiIndex = 0;
                }
            } else {
                if(konamiIndex > 0) {
                    log('❌ Reset (attendu: ' + expectedKey + ', reçu: ' + pressedKey + ')', 'error');
                }
                konamiIndex = 0;
            }
        }, true);

        log('🎮 Debug Konami initialisé', 'success');
        log('📝 Tapez: ↑ ↑ ↓ ↓ A B A B', 'info');
    </script>
</body>
</html>
