<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puissance 4 — Menu</title>
  <link rel="stylesheet" href="/static/font.css" />
  <style>
    body{min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center;background:#0f172a;color:#e5e7eb;font-family:system-ui,sans-serif}
    .card{background:#111827;border:1px solid #1f2937;border-radius:14px;padding:24px;box-shadow:0 8px 32px rgba(0,0,0,.35);width:min(720px,92vw)}
    h1{margin:0 0 12px 0;font-size:28px;color:#fff;text-align:center}
    p{margin:0 0 24px 0;text-align:center;color:#cbd5e1}
    .categories{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
    .category{background:#0b1220;border:1px solid #1e293b;border-radius:12px;padding:16px}
    .category h2{margin:0 0 12px 0;font-size:20px;color:#f8fafc;display:flex;align-items:center;gap:8px}
    .modes{display:grid;grid-template-columns:1fr;gap:10px}
    .mode{display:flex;flex-direction:column;padding:12px;background:#0f172a;border:1px solid #1e293b;border-radius:10px;transition:all .2s}
    .mode:hover{background:#111827;border-color:#334155}
    .mode h3{margin:0 0 4px 0;color:#f8fafc;font-size:16px}
    .mode small{color:#94a3b8;font-size:13px;line-height:1.4}
    button{background:#2563eb;color:white;border:none;border-radius:8px;padding:8px 12px;cursor:pointer;font-size:14px;margin-top:8px;width:100%}
    button:hover{background:#1d4ed8}
    .actions{margin-top:16px;display:flex;gap:12px;justify-content:center}
    a.button{background:#0b1220;color:#e2e8f0;border:1px solid #1e293b;border-radius:10px;padding:10px 16px;text-decoration:none;display:inline-flex;align-items:center;gap:8px}
    a.button:hover{background:#0f172a}
    @media(max-width:640px){.categories{grid-template-columns:1fr}}
    .custom-party{margin-top:20px;padding-top:12px;border-top:1px solid #1e293b}
    #party-code{margin-top:10px;text-align:center;color:#22c55e;font-weight:bold}
  </style>
</head>
<body>
  <div class="card">
    <h1>Choisir un mode de jeu</h1>
    <p>Sélectionnez votre catégorie et votre mode de jeu préféré</p>
    
    <div class="categories">
      <!-- Catégorie Solo -->
      <div class="category">
        <h2>🎮 Solo</h2>
        <div class="modes">
          <div class="mode">
            <h3>📈 Exponentiel</h3>
            <small>Plateau évolutif : 4, puis 5, puis 6 alignés... La grille grandit !</small>
            <button type="button" onclick="createSoloParty('solo-exponentiel')">Jouer</button>
          </div>
          <div class="mode">
            <h3>🎯 Classique</h3>
            <small>Puissance 4 traditionnel : grille 6×7, 4 pions alignés</small>
            <button type="button" onclick="createSoloParty('solo-classique')">Jouer</button>
          </div>
          <div class="mode">
            <h3>⚡ Turbo</h3>
            <small>Mode avec boosters et pouvoirs spéciaux !</small>
            <button type="button" onclick="createSoloParty('solo-turbo')">Jouer</button>
          </div>
        </div>
      </div>

      <!-- Catégorie Multi -->
      <div class="category">
        <h2>👥 Multijoueur</h2>
        <div class="modes">
          <div class="mode">
            <h3>📈 Exponentiel</h3>
            <small>Plateau évolutif en ligne avec des amis</small>
            <button type="button" onclick="createParty('multi-exponentiel')">Jouer</button>
          </div>
          <div class="mode">
            <h3>🎯 Classique</h3>
            <small>Puissance 4 traditionnel en multijoueur</small>
            <button type="button" onclick="createParty('multi-classique')">Jouer</button>
          </div>
          <div class="mode">
            <h3>⚡ Turbo</h3>
            <small>Mode turbo avec boosters en ligne !</small>
            <button type="button" onclick="createParty('multi-turbo')">Jouer</button>
          </div>
        </div>

        <!-- 👇 Nouvelle section : parties personnalisées -->
        <div class="custom-party">
          <h3>🎮 Parties personnalisées</h3>
          <small>Crée ou rejoins une partie avec un code unique</small>
          <button type="button" onclick="createParty()">Créer une partie</button>
          <button type="button" onclick="joinParty()">Rejoindre une partie</button>
          <p id="party-code"></p>
        </div>
      </div>
    </div>

    <div class="actions">
      <a class="button" href="/">← Retour à l'accueil</a>
    </div>
  </div>
  
  <script>
    // Créer une partie solo (sans afficher le code)
    async function createSoloParty(mode) {
      const res = await fetch("/api/party/create?mode=" + mode, { method: "POST" });
      const data = await res.json();
      console.log("Partie solo créée avec le code:", data.code, "mode:", mode);
      // Aller directement à la partie sans afficher le code
      window.location.href = "/game?code=" + data.code;
    }

    // Créer une partie multijoueur (avec affichage du code)
    async function createParty(mode) {
      const res = await fetch("/api/party/create?mode=" + mode, { method: "POST" });
      const data = await res.json();
      document.getElementById("party-code").textContent = "Code de la partie : " + data.code;
      
      // Demander de choisir l'équipe
      const team = prompt("Choisir ton équipe :\nTape 'R' pour Rouge 🔴\nTape 'Y' pour Jaune 🟡")?.toUpperCase();
      if (!team || (team !== 'R' && team !== 'Y')) {
        alert("❌ Équipe invalide ! Par défaut: Rouge 🔴");
        connectToParty(data.code, 'R');
        return;
      }
      
      alert("🎮 Partie créée ! Code : " + data.code + "\nTu es " + (team === 'R' ? 'Rouge 🔴' : 'Jaune 🟡') + "\nPartage ce code avec ton ami.");
      connectToParty(data.code, team);
    }

    async function joinParty() {
      const code = prompt("Entre le code de la partie :")?.toUpperCase();
      if (!code) return;
      const res = await fetch("/api/party/join?code=" + code, { method: "POST" });
      if (res.ok) {
        // Demander de choisir l'équipe
        const team = prompt("Choisir ton équipe :\nTape 'R' pour Rouge 🔴\nTape 'Y' pour Jaune 🟡")?.toUpperCase();
        if (!team || (team !== 'R' && team !== 'Y')) {
          alert("❌ Équipe invalide ! Choisir R ou Y");
          return;
        }
        alert("✅ Tu as rejoint la partie " + code + " en tant que " + (team === 'R' ? 'Rouge 🔴' : 'Jaune 🟡'));
        connectToParty(code, team);
      } else {
        alert("❌ Code invalide !");
      }
    }

    function connectToParty(code, team) {
      // Rediriger vers la page de jeu avec le code et l'équipe choisie
      const url = "/game?code=" + code + (team ? "&team=" + team : "");
      window.location.href = url;
    }
  </script>
</body>
</html>
